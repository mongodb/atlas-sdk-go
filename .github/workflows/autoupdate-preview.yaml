name: Generate Preview SDK
run-name: Generate Preview SDK - test
on:
  workflow_dispatch:
  
jobs:
  generate-client:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - uses: actions/setup-go@v5
        with:
          go-version-file: 'go.mod'
      - name: Fetch changes
        working-directory: ./tools
        run: make fetch_openapi
        env:
          API_BASE_URL: ${{ secrets.MDB_CURRENT_API_PREVIEW_URL }}
          S3_BUCKET: ${{ secrets.MDB_CURRENT_API_PREVIEW_S3_BUCKET }}
      - name: Verify Changed files
        uses: tj-actions/verify-changed-files@efd71c265f4cde5b8034ff975235697e24384057
        id: verify-changed-files
        with:
          files: |
             **/atlas-api.yaml
      - name: Run generation
        if: steps.verify-changed-files.outputs.files_changed == 'true'
        working-directory: ./tools
        run: make clean_and_generate
      - name: Run mock generation
        working-directory: ./tools
        if: steps.verify-changed-files.outputs.files_changed == 'true'
        run: make generate_mocks_linux  

            




